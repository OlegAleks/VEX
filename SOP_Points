// If your geometry for Bullet sim uses Baked ODE primitives, then you might want to get cleared geo to cache on disk.
// So this code creates attributes so that copy_to_points SOP will 100% match to geometry from sim.
vector pivot = primintrinsic(geoself(), "pivot", @ptnum);
matrix3 m = primintrinsic(geoself(), "transform", @ptnum);
p@orient = quaternion(m);
matrix xf = primintrinsic(geoself(), "packedfulltransform", @ptnum);
vector pscale = cracktransform(XFORM_TRS, XFORM_XYZ, 2, {0,0,0}, xf);
f@pscale = pscale[0];
v@P = {0,0,0}*xf + pivot;
string a[] = array(@name, "/Shape_", @name);
string path = "/";
foreach(string s; a){
    path = concat(path, s);
    s@path = path;
}

// Clip by camera frustum
vector P_ndc = toNDC(chs("camera"), @P);
float over = chf("overscan");
if(max(P_ndc.x, P_ndc.y)>(1+over) || min(P_ndc.x, P_ndc.y)<(0-over)) removepoint(geoself(), @ptnum);

// Instance attribute for RedShift
f@pscale *=0.01;
int num = chi("num");
if(num>0)
{
   int c = @ptnum%num;
   string path = concat("obj", itoa(c+1));
   s@instance = chs(path);
}

